<link rel="import" href="sugar_task_editor.html">
<link rel="import" href="sugar_task_summary.html">

<dom-module id="sugar-task-list-item">
  <template>
    <div id="readView" hidden="{{isBeingEdited}}" class="row">
      <sugar-task-summary task="{{task}}"
                          class="col-md-10"></sugar-task-summary>
      <div class="col-md-2">
        <button id="editorEnter" class="btn btn-sm btn-default pull-right">
          <i title="edit" class="glyphicon glyphicon-edit"></i></button>
      </div>
    </div>
    <div id="editView" hidden="{{!isBeingEdited}}" class="row">
      <sugar-task-editor task="{{editorTask}}"
                         knownTags="{{knownTags}}"></sugar-task-editor>
      <div class="col-md-2">
        <div class="pull-right">
          <button id="editorSave"
                  class="btn btn-sm btn-primary">Save</button>
          <button id="editorCancel"
                  class="btn btn-sm btn-default">Cancel</button>
      </div>
    </div>
  </template>
  <script>
Polymer({
  is: 'sugar-task-list-item',

  properties: {
    task: Object,
    knownTags: Array,
    editorTask: Object,
    isBeingEdited: {
      type: Boolean,
      value: false
    }
  },

  listeners: {
    'editorEnter.tap': 'onEditorEnter',
    'editorSave.tap': 'onEditorSave',
    'editorCancel.tap': 'onEditorCancel'
  },

  onEditorEnter: function() {
    // Make a shallow copy of the task for the editor to use. This allows the
    // user to hit a cancel button and have the task stay in its prior state.
    var taskCopy = {};
    Object.assign(taskCopy, this.task);
    this.set('editorTask', taskCopy);
    this.isBeingEdited = true;
  },

  onEditorSave: function() {
    this.fire('edit-task', this.editorTask);
    this.isBeingEdited = false;
  },

  onEditorCancel: function() {
    this.isBeingEdited = false;
  }
});
  </script>
</dom-module>
