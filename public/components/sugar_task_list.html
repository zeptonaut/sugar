<link rel="import" href="sugar_task_list_item.html">

<dom-module id="sugar-task-list">
  <template>
    <h2>Tasks</h2>
    <ul>
      <template is="dom-repeat"
                items="{{tasks}}"
                filter="isIncomplete_"
                sort="taskCompare_"
                observe="status scheduledTime deadlineTime">
        <li><sugar-task-list-item task="{{item}}"></sugar-task-list-item></li>
      </template>
    </ul>

    <h2>Tasks (completed)</h2>
    <ul>
      <template is="dom-repeat"
                items="{{tasks}}"
                filter="isComplete_"
                sort="taskCompare_"
                observe="status scheduledTime deadlineTime">
        <li><sugar-task-list-item task="{{item}}"></sugar-task-list-item></li>
      </template>
    </ul>
  </template>
  <script>
Polymer({
  is: 'sugar-task-list',

  properties: {
    tasks: Array
  },

  isIncomplete_: function(task) {
    return task.status === '' || task.status === 'todo' ||
      task.status === 'waiting';
  },

  isComplete_: function(task) {
    return task.status === 'done';
  },

  /**
   * Compare function that determines the order of tasks in the list.
   */
  taskCompare_: function(task1, task2) {
    var task1Scheduled = task1.scheduledTime || Infinity;
    var task2Scheduled = task2.scheduledTime || Infinity;
    var task1Deadline = task1.deadlineTime || Infinity;
    var task2Deadline = task2.deadlineTime || Infinity;

    var task1Time = Math.min(task1Scheduled, task1Deadline);
    var task2Time = Math.min(task2Scheduled, task2Deadline);

    return task1Time - task2Time;
  }
});
  </script>
</dom-module>
